server.port: ${random.int[8080,9999]}
spring.cloud:
    function.definition: payment
    stream:
        default-binder: kafka
        kafka:
            binder:
                brokers: ${KAFKA_BOOTSTRAP_SERVERS:10.10.15.85:32092}
                consumerProperties:
                    max.poll.records: 5
            bindings:
                synchronize-in-0:
                    consumer:
                        configuration:
                            key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
                            #group.instance.id: ${SYNCHRONIZER_GROUP_INSTANCE_ID:ins01}
                report-in-0:
                    consumer:
                        resetOffsets: true
                        startOffset: earliest
                        configuration:
                            key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
                processCustomer-in-0:
                    consumer:
                        configuration:
                            key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
                processCustomer-out-0:
                    producer:
                        configuration:
                            key.serializer: org.apache.kafka.common.serialization.StringSerializer
                        messageKeyExpression: headers['traceId']
                        topic.properties:
                            cleanup.policy: compact
                            segment.ms: 300000 # 5 minutes
                            segment.bytes: 1048576 # 1 MB
                produceCustomer-out-0:
                    producer:
                        configuration:
                            key.serializer: org.apache.kafka.common.serialization.StringSerializer
                        messageKeyExpression: headers['traceId']
                        topic.properties:
                            cleanup.policy: compact
                            segment.ms: 300000 # 5 minutes
                            segment.bytes: 1048576 # 1 MB
        bindings:
            synchronize-in-0:
                group: rd-synchronizer-${SYNCHRONIZER_GROUP_INSTANCE_ID}
                destination: rd-customers
                startOffset: earliest                        
                batch-mode: true
            report-in-0:
                group: rd-reporter
                destination: rd-customers
                startOffset: earliest                        
                batch-mode: true
            processCustomer-in-0:
                group: rd-processor
                destination: rd-customers
                startOffset: latest                         
                batch-mode: false
            processCustomer-out-0:
                destination: rd-customers
                startOffset: latest
            produceCustomer-out-0:
                destination: rd-customers
                contentType: application/json
            payment-in-0:
                group: rd-researcher
                destination: rd-payments
                startOffset: latest                        
                batch-mode: false
logging.file.name: ./logs/cloud-kafka.log
